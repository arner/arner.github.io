<!doctype html><html><head><title>Posts</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><link rel=stylesheet href=https://arner.github.io/assets/css/main.css><noscript><link rel=stylesheet href=https://arner.github.io/assets/css/noscript.css></noscript><style>:root{--site-background: url("https://arner.github.io/images/bg.jpg")}</style><script src=https://identity.netlify.com/v1/netlify-identity-widget.js></script></head><body class=is-preload><div id=wrapper><header id=header><div class=logo><a href=/><span class="icon fa-flag"></span></a></div><div class=content><div class=inner><h1>Posts</h1></div></div><nav><ul><li><a href=#make-glados-clean-your-floor>Make GLaDOS clean your floor</a></li><li><a href=#root-your-xiaomi-vacuum>Root your Xiaomi vacuum</a></li><li><a href=#install-the-glados-voice-pack>Install the GLaDOS voice pack</a></li><li><a href=#install-the-oucher>Install the oucher</a></li></ul></nav></header><div id=main><article id=install-the-oucher><h2 class=major>Install the oucher</h2><span class="image main"><img src alt></span><p>This post is part of a series.</p><ul><li>Do you want to <a href=/posts/#make-glados-clean-your-floor>make GLaDOS clean your floor</a>?</li><li>Have you <a href=/posts/#root-your-xiaomi-vacuum>rooted your Xiaomi or Roborock vacuum cleaner</a>?</li><li>Have you <a href=/posts/#install-the-glados-voice-pack>installed the GLaDOS voice pack</a>?</li></ul><p>Do you want to make her say stuff when she bumps into something?</p><p>Good, let&rsquo;s continue.</p><p>A vacuum robot that verbally reacts when it bumps into things is surprisingly funny.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/AlV1m1Ropq8 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>It&rsquo;s also a good way to add a bit more personality to a robot that already has a <a href=/posts/#install-the-glados-voice-pack>voice pack installed</a>.</p><p>Thanks to a clever tool called <a href=https://github.com/porech/roborock-oucher target=_blank>oucher</a> it&rsquo;s easy to achieve it - without the hardware in the video. It&rsquo;s a program that runs on your vacuum (just like <a href=https://valetudo.cloud/ target=_blank>Valetudo</a>). When it sees a &lsquo;Bumper&rsquo; event in the logs, it plays a sound. You need a <a href=/posts/#root-your-xiaomi-vacuum>rooted Xiaomi or Roborock vacuum cleaner</a> with SSH access.</p><h2 id=installing-the-oucher>Installing the oucher</h2><p>Clone the oucher repo and enter the directory.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/porech/roborock-oucher.git
cd roborock-oucher
</code></pre></div><p>To make the next steps a bit easier, we&rsquo;ll assign the IP address of your vacuum to a variable. Find it on the status page of your router or with a mobile app called Fing.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>export IP<span style=color:#f92672>=</span>192.168.xxx.x
</code></pre></div><p>First, SSH into the vacuum to install a few packages.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh root@$IP
</code></pre></div><p>From within the vacuum shell (it starts with <code>root@rockrobo:~#</code>):</p><pre><code class=language-console data-lang=console>mkdir /mnt/data/oucher
apt-get -y update
apt-get -y install espeak sox alsa-utils
apt-get -y clean
exit
</code></pre><p>Back on your own computer, edit oucher.yml. Set <code>delay: 10</code> and<code>phrases: []</code> to make it not too chatty and to make it use sound files exclusively.</p><p>Now copy the files to the vacuum:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>scp oucher.conf root@$IP:/etc/init/
scp oucher root@$IP:/usr/local/bin/
scp oucher.yml root@$IP:/mnt/data/oucher/
</code></pre></div><p><a href="http://s000.tinyupload.com/?file_id=81925662786830967138" target=_blank>Download the sounds</a> and unzip them.</p><blockquote><p>It&rsquo;s more fun to create your own set.
Find the right samples, for instance on <a href="http://www.portal2sounds.com/#w=glados" target=_blank>portal2sounds.com</a>
(download via &lsquo;direct link&rsquo;).
Convert mp3 to wav like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>for</span> i in *.mp3; <span style=color:#66d9ef>do</span> ffmpeg -i <span style=color:#e6db74>&#34;</span>$i<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;sounds/</span><span style=color:#e6db74>${</span>i%.*<span style=color:#e6db74>}</span><span style=color:#e6db74>.wav&#34;</span>; <span style=color:#66d9ef>done</span>
</code></pre></div><p>This requires <a href=https://ffmpeg.org/ target=_blank>ffmpeg</a> to be installed.</p></blockquote><p>Copy the sounds directory to the vacuum:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>scp -r sounds root@IP:/mnt/data/oucher/
</code></pre></div><p>Make the program executable and start the service:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh root@$IP chmod +x /usr/local/bin/oucher
ssh root@$IP service oucher start
</code></pre></div><h2 id=done>Done!</h2><p>Your vacuum should now sound a little something like this:</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/gldJOiC2ZSo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>Did you create your own voice pack? Share it in the <a href="https://www.youtube.com/watch?v=gldJOiC2ZSo" target=_blank>comments</a> on YouTube!</p></article><article id=install-the-glados-voice-pack><h2 class=major>Install the GLaDOS voice pack</h2><span class="image main"><img src alt></span><p>This post is part of a series.</p><ul><li>Do you want to <a href=/posts/#make-glados-clean-your-floor>make GLaDOS clean your floor</a>?</li><li>Have you <a href=/posts/#root-your-xiami-vacuum>rooted your Xiaomi or Roborock vacuum cleaner</a>?</li></ul><p>Good. Let&rsquo;s continue.</p><p>The lazy version of this is actually really simple.</p><h1 id=the-lazy-version>The lazy version</h1><ol><li>Download the GLaDOS voice pack <a href=https://github.com/arner/roborock-glados/releases/download/v1/custom-v1.zip target=_blank>here</a> and unzip it.</li><li>Visit Valetudo in your browser (the IP of your vacuum) and go to <em>Settings -> Sound and voice</em>. Upload the downloaded .pkg file and press <em>Upload Voice Pack</em>.</li><li>Done!</li></ol><blockquote><p>Alternatively, you can use <a href=https://python-miio.readthedocs.io/en/latest/vacuum.html#sounds target=_blank>python-miio</a>, the tool we installed in the <a href=/posts/#root-your-xiaomi-vacuum>previous step</a>.</p></blockquote><h1 id=the-creative-version>The creative version</h1><p>The voice pack above consists of two parts; generated text-to-speech and actual Portal samples.</p><p>You can customize both of them, meaning that you can make GLaDOS say whatever you want her to! <a href=https://github.com/arner/roborock-glados target=_blank>The README of my git repo</a> describes how to do it. On a high level, you&rsquo;ll:</p><ol><li>Clone the repo and install a few tools</li><li>Customize the text of what the text-to-speech engine will say</li><li>Download and convert original samples of your choice</li><li>Package the sounds.</li></ol><p>After this, you can go back to step 2 of the lazy version.</p><h1 id=next-step>Next step</h1><p>The Xiaomi vacuum is too quiet and polite for GLaDOS, we need a bit more character. Luckily, there&rsquo;s the aptly named tool <em>oucher</em> that can make her talk whenever she bumps into something.</p><p>Lets <a href=/posts/#install-the-oucher>install the oucher</a>!</p></article><article id=root-your-xiaomi-vacuum><h2 class=major>Root your Xiaomi vacuum</h2><span class="image main"><img src alt></span><p>This guide describes how to root your Xiaomi/Roborock vacuum (meaning to gain administrator access). Check <a href=https://builder.dontvacuum.me/ target=_blank>here</a> if it works on yours.</p><p>The standard firmware requires a connection to the internet and it transmits information about your wifi SSID, gateway mac address and other information like your floor plan to Xiaomi&rsquo;s servers every thirty minutes. If this makes you feel a bit uncomfortable, good, read on.</p><p>Rooting changes your vacuum cleaner from an appliance that needs the Chinese cloud to function to a computer that you own and control via your local wifi directly. A Xiaomi or Roborock vacuum cleaner is just a computer that runs linux. So as a bonus, you can do other cool stuff like installing custom voicepacks and other cool hacks.</p><p>The world of vacuum rooting can be a bit overwhelming so here&rsquo;s a few names you might encounter:</p><ul><li><strong>DustCloud</strong> is where it all started. It&rsquo;s a git repo by a guy called Dennis Giese that describes the process and tools for hacking Xiaomi devices.</li><li><strong>DustBuilder</strong> is a web tool by the same guy that can build the firmware for you so you don&rsquo;t have to do it yourself.</li><li><strong>Valetudo</strong> is is a standalone program which runs on rooted roborock vacuums and allows you to control it without the cloud.</li><li><strong>Valetudo RE</strong> is a fork of Valetudo with more functionality.</li><li><strong>python-miio</strong> is a tool to talk to Xiaomi devices.</li><li><strong>Win Mirobot 1.1.0</strong> is an alternative tool to install the firmware or voicepacks. We won&rsquo;t be using it in this guide.</li></ul><p>This is what the interface of Valetudo looks like:</p><p><img src=../valetudo.png alt="valetudo screenshot"></p><p>Simple and practical.</p><h1 id=getting-started>Getting started</h1><p>We&rsquo;re gonna follow the following steps:</p><ol><li>Download custom (rooted) firmware.</li><li>Get a secret token from your device.</li><li>Install the firmware on the vacuum (<em>flash</em> it).</li><li>Set up Valetudo.</li></ol><h2 id=download-custom-firmware>Download custom firmware</h2><h3 id=generate-ssh-key>Generate SSH key</h3><p>For our later steps, we will need an SSH key to be able to access the command line of the vacuum from the computer you&rsquo;re currently using.</p><p>You can let DustBuilder create one for you, but it&rsquo;s more secure to do it yourself.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen -o -a <span style=color:#ae81ff>100</span> -t ed25519
</code></pre></div><h3 id=build-the-custom-firmware>Build the custom firmware</h3><p>Go to <a href=https://builder.dontvacuum.me/ target=_blank>https://builder.dontvacuum.me/</a> and select your vacuum.</p><p>In the form, enter your email. Select <em>Your SSH-Public key</em> and browse for it (it&rsquo;s <code>[your home directory]/.ssh/id_ed25519.pub</code>). The other default settings are fine.</p><p>After submitting, it can take a few minutes before you receive a link to your firmware in the mail. When you do, download it. It&rsquo;s called something like <code>v11_004018.pkg</code>. In the meantime, you can continue with the next step.</p><h2 id=get-the-token-from-your-device>Get the token from your device</h2><p>Make sure you have the following software installed on your computer:</p><ul><li>python3</li><li>python3-pip</li></ul><p>Now execute the following commands:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pip3 install wheel
pip3 install python-miio
</code></pre></div><p>Reset the vacuum&rsquo;s wifi. For the first generation Xiaomi, this means pressing and holding the home and power buttons for 3-5 seconds.</p><p>After a short while your vacuum starts broadcasting a wifi access point. Move the device close to your computer and connect the computer to the access point. If you use a VPN, turn it off.</p><p>Run the following command to get your token:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mirobo --debug discover --handshake true
</code></pre></div><h2 id=flash-the-firmware>Flash the firmware</h2><p>Find your local IP address. In windows, run <code>ipconfig</code> and look for your IPv4 address. On MacOS or Linux, run <code>ifconfig | grep 192.</code>.</p><p>Before running the command below, make sure you replace the token value, your ip and the path to the built image.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mirobo --ip 192.168.8.1 --token &lt;the token&gt; update-firmware --ip &lt;your ip address&gt; &lt;path/to/built/image.pkg&gt;
</code></pre></div><p>It should look something like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mirobo --ip 192.168.8.1 --token 0f33a5fd27d421ddb8980 update-firmware --ip 192.168.8.2 ../v11_004018.pkg
</code></pre></div><p>The update will take up to about 10 minutes. The vacuum will tell you when it&rsquo;s done.</p><h2 id=connect-to-your-vacuum>Connect to your vacuum</h2><p>After reconnecting your computer to the vacuums wifi, access the vacuum with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh root@192.168.8.1
</code></pre></div><p>Because your public key was included in the firmware, you will be granted access. You&rsquo;re now a user in the linux operating system running on your vacuum cleaner! What a time to be alive.</p><p>Feel free to poke around a bit and take a moment to enjoy the hacker vibes. Think of the possibilities! You could run any linux program on here&mldr;</p><p>But first, restart the vacuum:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>reboot -h now
</code></pre></div><h3 id=set-up-valetudo>Set up Valetudo</h3><p>When it&rsquo;s done rebooting (make sure your computer is connected to the vacuum&rsquo;s wifi again), visit <code>http://192.168.8.1</code> in your browser to set up the connection from the vacuum to your wifi router.</p><p>After doing that, the vacuum no longer has a wifi access point. Get its new IP address (for instance on your router&rsquo;s status page, or with a mobile app called Fing).</p><p>Visit the address in your browser.</p><p>Done! You can now control your vacuum from your local network.</p><h2 id=next-steps>Next steps</h2><p>Now you have a rooted vacuum cleaner, let&rsquo;s <a href=/posts/#install-the-glados-voice-pack>install a custom voice pack to it</a>.</p></article><article id=make-glados-clean-your-floor><h2 class=major>Make GLaDOS clean your floor</h2><span class="image main"><img src alt></span><p>Since last weekend my floor is cleaned by <a href=https://theportalwiki.com/wiki/GLaDOS target=_blank>GLaDOS</a>, the artificial intelligence who supervises the Aperture Science testing facilities in the Portal games.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/l_V5AHoImqk style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>Watch this video to get an idea of her delightful personality. Buy the games on Steam if you haven&rsquo;t played them yet, they&rsquo;re awesome!</p><p>In this series of blog posts I&rsquo;ll document how I got her to perform the simple task of cleaning my floor - albeit somewhat reluctantly.</p><p>If you want to follow along, all you need is Xiaomi or Roborock vacuum cleaner, a bit of comfort using the command line and the appetite to play around. Mine is a first generation Xiaomi, but it should work on other generations as well (see if it&rsquo;s featured on the pictures <a href=https://builder.dontvacuum.me/ target=_blank>here</a>).</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/gldJOiC2ZSo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>This is what you&rsquo;ll end up with. As you can see, she&rsquo;s still alive and we&rsquo;re getting along just fine.</p><p>Here&rsquo;s what we&rsquo;ll do:</p><ol><li><a href=/posts/#root-your-xiaomi-vacuum>Root your Xiaomi or Roborock vacuum</a> (it has other benefits as well).</li><li><a href=/posts/#install-the-glados-voice-pack>Install the GLaDOS voice pack</a></li><li><a href=/posts/#install-the-oucher>Make it play a sound when it bumps into something</a>.</li></ol><p>Have fun!</p></article></div><footer id=footer><p class=copyright>&copy; Design: <a href=https://github.com/d-asnaghi>d-asnaghi</a> and <a href=https://html5up.net>HTML5 UP</a>.</p></footer></div><div id=bg></div></body><script src=https://arner.github.io/assets/js/jquery.min.js></script><script src=https://arner.github.io/assets/js/browser.min.js></script><script src=https://arner.github.io/assets/js/breakpoints.min.js></script><script src=https://arner.github.io/assets/js/util.js></script><script src=https://arner.github.io/assets/js/main.js></script></html>